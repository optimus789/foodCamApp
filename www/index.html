<!DOCTYPE html>
<html>


<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy"
        content="default-src *; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; width=device-width, initial-scale=1.0" />
    <title>PhoneGap app</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/all.min.css" rel="stylesheet">
    <link href="css/solid.min.css" rel="stylesheet">
    <!-- Script -->
    <script type=" text/javascript" src="cordova.js"></script>
    <script type='text/javascript' src='js/jquery-3.4.min.js'></script>
    <script src="js/bootstrap.min.js" type="text/javascript"></script>

    <script type='text/javascript'>



        $(document).ready(function () {

            var s = window.localStorage;
            age = parseInt(s.getItem("Age"));
            weight = parseInt(s.getItem("Weight"));
            gender = s.getItem("Gender");

            if (s.getItem("Name") == null) {
                alert("Now You will be redirected to enter your data ")
                window.location = "profile.html";
            } else {
                // take picture from camera
                $('#but_take').click(function () {
                    navigator.camera.getPicture(onSuccess, onFail, {
                        quality: 75,
                        targetWidth: 350,
                        destinationType: Camera.DestinationType.FILE_URL
                    });
                    document.getElementById("predictions").style.display = "none";
                });

                // upload select 
                $("#but_select").click(function () {
                    navigator.camera.getPicture(onSuccess, onFail, {
                        quality: 75,
                        targetWidth: 325,
                        sourceType: Camera.PictureSourceType.PHOTOLIBRARY,
                        allowEdit: true,
                        destinationType: Camera.DestinationType.FILE_URI
                    });
                    document.getElementById("predictions").style.display = "none";
                });

                // Change image source and upload photo to server
                function onSuccess(imageURI) {
                    // Set image source
                    var image = document.getElementById('img');
                    image.src = imageURI + '?' + Math.random();

                    var options = new FileUploadOptions();
                    options.fileKey = "file";
                    options.fileName = imageURI.substr(imageURI.lastIndexOf('/') + 1);
                    options.mimeType = "image/jpeg";

                    var params = {};
                    params.value1 = "test";
                    params.value2 = "param";

                    options.params = params;
                    options.chunkedMode = false;

                    var ft = new FileTransfer();
                    ft.upload(imageURI, "https://gt29.pythonanywhere.com/predict/", function (result) {
                        //alert('successfully uploaded ' + 'result is ' + result.response);
                        alert(result.response);
                        //document.querySelector("#textArea").innerHTML = result.response;
                        $.getJSON('https://gt29.pythonanywhere.com/media/data_file.json', function (data) {
                            document.getElementById("predictions").style.display = "block";
                            alert(data)
                            document.getElementById("p1-name").innerHTML = data.prediction[0].Name;
                            document.getElementById("p1-probab").innerHTML = data.prediction[0].Value.toPrecision(6) + " %";
                            alert(parseInt(data.prediction[0].Serving, 10));
                            var dv1 = 1;
                            if (parseInt(data.prediction[0].Serving, 10) > 200) {
                                var n = parseInt(data.prediction[0].Serving, 10);
                                alert(n)
                                dv1 = n / 100;
                                document.getElementById("p1-serv").innerHTML = "Per 100g";
                            }
                            else {
                                document.getElementById("p1-serv").innerHTML = data.prediction[0].Serving;
                            }
                            document.getElementById("p1-cal").innerHTML = parseInt(data.prediction[0].Calories, 10) / dv1 + "kcal";
                            var cal = parseInt(data.prediction[0].Calories, 10);
                            var cal_old = parseInt(s.getItem("Cal_cur"));
                            alert("Calories cur:" + cal);
                            cal_old = cal_old + cal;
                            s.setItem("Cal_cur", cal_old);
                            alert("Calories old:" + cal_old);
                            document.getElementById("p1-fat").innerHTML = parseInt(data.prediction[0].Fat, 10) / dv1 + "g";
                            document.getElementById("p1-carb").innerHTML = parseInt(data.prediction[0].Carbs, 10) / dv1 + "g";
                            document.getElementById("p1-prot").innerHTML = parseInt(data.prediction[0].Protein, 10) / dv1 + "g";

                            document.getElementById("p2-name").innerHTML = data.prediction[1].Name;
                            document.getElementById("p2-probab").innerHTML = data.prediction[1].Value.toPrecision(4) + " %";
                            document.getElementById("p2-serv").innerHTML = data.prediction[1].Serving;
                            document.getElementById("p2-cal").innerHTML = data.prediction[1].Calories;
                            document.getElementById("p2-fat").innerHTML = data.prediction[1].Fat;
                            document.getElementById("p2-carb").innerHTML = data.prediction[1].Carbs;
                            document.getElementById("p2-prot").innerHTML = data.prediction[1].Protein;

                            document.getElementById("p3-name").innerHTML = data.prediction[2].Name;
                            document.getElementById("p3-probab").innerHTML = data.prediction[2].Value.toPrecision(4) + " %";
                            document.getElementById("p3-serv").innerHTML = data.prediction[2].Serving;
                            document.getElementById("p3-cal").innerHTML = data.prediction[2].Calories;
                            document.getElementById("p3-fat").innerHTML = data.prediction[2].Fat;
                            document.getElementById("p3-carb").innerHTML = data.prediction[2].Carbs;
                            document.getElementById("p3-prot").innerHTML = data.prediction[2].Protein;
                        });


                    }, function (error) {
                        alert('error : ' + JSON.stringify(error));
                    }, options);

                }
            }

            function onFail(message) {
                alert('Failed because: ' + message);
            }
        });


    </script>
    <style>
        table {
            padding: auto;
            border: 1px solid #1c87c9;
            border-radius: 5px;
            background-color: #e5e5e5;
            text-align: center;
            font-size: 10.5px;
            display: none;
            transition: 3s;
        }


        td,
        th {
            padding: auto;
            border: 1px solid #1c87c9;
            border-radius: 5px;
            background-color: #e5e5e5;
            text-align: center;
            font-size: 10.5px;

            transition: 3s;
        }

        #predictions {
            display: none;
        }
    </style>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="#">Food Nutrition App</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false">
            <i class="fas fa-hamburger"></i>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="index.html">Home <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="profile.html">Profile</a>
                </li>

            </ul>
        </div>
    </nav>
</head>

<body class="" style="  background-image: linear-gradient(60deg,#ebebeb,#fff); 
    filter: drop-shadow(0rem 0rem 0.5rem #ebebeb);background-repeat: no-repeat;">

    <div class="container">
        <div class=" card shadow-lg  ">
            <div class=" card-body mt-5">
                <div class="" style="text-align: center;">
                    <img src="img/cam2.jpg" id='img' style="width: 160px; height: 140px; margin-right: 10px;">
                </div><br />

                <div style="width:100%; text-align:center; padding:10px;">
                    <button class="btn btn-outline-success" id='but_take'>Take photo</button>
                    <br><br>
                    <button class="btn btn-outline-primary" id='but_select'>Select photo from Gallery</button>
                    <br><br>
                    <!-- <p id="textArea" class="text-white" style="font-size: 20px;">hello</p>
            <p id="textArea" class="text-white" style="font-size: 20px;">hello</p>
            <p id="textArea" class="text-white" style="font-size: 20px;">hello</p>
            <p id="textArea" class="text-white" style="font-size: 20px;">hello</p>-->


                </div>
            </div>
        </div>

        <div id="predictions">
            <div class="card mt-3">
                <div class="card-body">
                    <div class="container">
                        <div class="row">

                            <div class="col-6  m-auto">
                                <h5 class="text-success ">Name</h5>

                            </div>
                            <div class="col-6 m-auto text-center">

                                <h5 id="p1-name"> </h5>
                            </div>

                        </div>
                        <hr>
                        <div class="row">

                            <div class="col-6">
                                <h6 class="text-success">Probability</h6>

                            </div>
                            <div class="col-6">
                                <h6 id="p1-probab"> </h6>


                            </div>

                        </div>
                        <div class="row">

                            <div class="col-6">
                                <h6 class="text-success">Serving</h6>

                            </div>
                            <div class="col-6">
                                <h6 id="p1-serv"> </h6>


                            </div>

                        </div>
                        <div class="row">

                            <div class="col-6">
                                <h6 class="text-success">Calories</h6>

                            </div>
                            <div class="col-6">
                                <h6 id="p1-cal"> </h6>


                            </div>

                        </div>
                        <div class="row">

                            <div class="col-6">
                                <h6 class="text-success">Fat</h6>

                            </div>
                            <div class="col-6">
                                <h6 id="p1-fat"> </h6>


                            </div>

                        </div>
                        <div class="row">

                            <div class="col-6">
                                <h6 class="text-success">Carbs</h6>

                            </div>
                            <div class="col-6">
                                <h6 id="p1-carb"> </h6>


                            </div>

                        </div>
                        <div class="row">

                            <div class="col-6">
                                <h6 class="text-success">Protein</h6>

                            </div>
                            <div class="col-6">
                                <h6 id="p1-prot"> </h6>


                            </div>

                        </div>
                    </div>


                </div>

            </div>

            <div class="card mt-3">
                <div class="card-body">
                    <div class="container">
                        <div class="row">

                            <div class="col-6  m-auto">
                                <h6 class="text-warning ">Name</h6>

                            </div>
                            <div class="col-6 m-auto text-center">

                                <h6 id="p2-name"> </h6>
                            </div>

                        </div>
                        <hr>
                        <div class="row">

                            <div class="col-6">
                                <h6 class="text-warning">Probability</h6>

                            </div>
                            <div class="col-6">
                                <h6 id="p2-probab"> </h6>


                            </div>

                        </div>
                        <div class="row">

                            <div class="col-6">
                                <h6 class="text-warning">Serving</h6>

                            </div>
                            <div class="col-6">
                                <h6 id="p2-serv"> </h6>


                            </div>

                        </div>
                        <div class="row">

                            <div class="col-6">
                                <h6 class="text-warning">Calories</h6>

                            </div>
                            <div class="col-6">
                                <h6 id="p2-cal"> </h6>


                            </div>

                        </div>
                        <div class="row">

                            <div class="col-6">
                                <h6 class="text-warning">Fat</h6>

                            </div>
                            <div class="col-6">
                                <h6 id="p2-fat"> </h6>


                            </div>

                        </div>
                        <div class="row">

                            <div class="col-6">
                                <h6 class="text-warning">Carbs</h6>

                            </div>
                            <div class="col-6">
                                <h6 id="p2-carb"> </h6>


                            </div>

                        </div>
                        <div class="row">

                            <div class="col-6">
                                <h6 class="text-warning">Protein</h6>

                            </div>
                            <div class="col-6">
                                <h6 id="p2-prot"> </h6>


                            </div>

                        </div>
                    </div>


                </div>

            </div>

            <div class="card mt-3">
                <div class="card-body">
                    <div class="container">
                        <div class="row">

                            <div class="col-6  m-auto">
                                <h6 class="text-danger ">Name</h6>

                            </div>
                            <div class="col-6 m-auto text-center">

                                <h6 id="p3-name"> </h6>
                            </div>

                        </div>
                        <hr>
                        <div class="row">

                            <div class="col-6">
                                <h6 class="text-danger">Probability</h6>

                            </div>
                            <div class="col-6">
                                <h6 id="p3-probab"> </h6>


                            </div>

                        </div>
                        <div class="row">

                            <div class="col-6">
                                <h6 class="text-danger">Serving</h6>

                            </div>
                            <div class="col-6">
                                <h6 id="p3-serv"> </h6>


                            </div>

                        </div>
                        <div class="row">

                            <div class="col-6">
                                <h6 class="text-danger">Calories</h6>

                            </div>
                            <div class="col-6">
                                <h6 id="p3-cal"> </h6>


                            </div>

                        </div>
                        <div class="row">

                            <div class="col-6">
                                <h6 class="text-danger">Fat</h6>

                            </div>
                            <div class="col-6">
                                <h6 id="p3-fat"> </h6>


                            </div>

                        </div>
                        <div class="row">

                            <div class="col-6">
                                <h6 class="text-danger">Carbs</h6>

                            </div>
                            <div class="col-6">
                                <h6 id="p3-carb"> </h6>


                            </div>

                        </div>
                        <div class="row">

                            <div class="col-6">
                                <h6 class="text-danger">Protein</h6>

                            </div>
                            <div class="col-6">
                                <h6 id="p3-prot"> </h6>


                            </div>

                        </div>
                    </div>


                </div>

            </div>

            <table id="tab1" class="d-none">
                <tr>
                    <th>Name</th>
                    <th>Probability</th>
                    <th>Serving</th>
                    <th>Calories</th>
                    <th>Fat</th>
                    <th>Carbs</th>
                    <th>Protein</th>
                </tr>
                <tr>
                    <td id="td01"></td>
                    <td id="td02"></td>
                    <td id="td03"></td>
                    <td id="td04"></td>
                    <td id="td05"></td>
                    <td id="td06"></td>
                    <td id="td07"></td>
                </tr>
                <tr>
                    <td id="td11"></td>
                    <td id="td12"></td>
                    <td id="td13"></td>
                    <td id="td14"></td>
                    <td id="td15"></td>
                    <td id="td16"></td>
                    <td id="td17"></td>
                </tr>
                <tr>
                    <td id="td21"></td>
                    <td id="td22"></td>
                    <td id="td23"></td>
                    <td id="td24"></td>
                    <td id="td25"></td>
                    <td id="td26"></td>
                    <td id="td27"></td>
                </tr>

            </table>
        </div>
        <p class="text-center m-4">Developed by Garima Kaushik</p>
    </div>
</body>


</html>